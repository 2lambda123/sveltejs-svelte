import { update_expected } from "../update";

// this file will replace all the expected.js files with their _actual
// equivalents. Only use it when you're sure that you haven't
// broken anything!

function loadConfig(file) {
	try {
		const resolved = require.resolve(file);
		delete require.cache[resolved];

		const config = require(resolved);
		return config.default || config;
	} catch (err) {
		if (err.code === "MODULE_NOT_FOUND") {
			return {};
		}

		throw err;
	}
}

update_expected((compile, check, get_relative) => {
	check(
		"expected.js",
		compile(loadConfig(get_relative("_config.js")).options).js.code.replace(
			/generated by Svelte v\d+\.\d+\.\d+(-\w+\.\d+)?/,
			"generated by Svelte vX.Y.Z"
		)
	);
}, __dirname);