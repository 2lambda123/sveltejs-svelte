<!-- TODO need to rethink transition events!
     Perhaps add on:introend etc on the elements? -->

<script>
	import { onMount } from 'svelte';

	// [svelte-upgrade suggestion]
	// manually refactor all references to __this
	const __this = {};

	export let things;
	export let visible;

	function foo(node, params) {
		return {
			duration: 100,
			tick: t => {
				node.foo = t;
			}
		};
	}

	onMount(() => {
		__this.intros = [];
		__this.outros = [];
		__this.introCount = 0;
		__this.outroCount = 0;

		__this.on('intro.start', ({ node }) => {
			__this.intros.push(node.textContent);
			__this.introCount += 1;
		});

		__this.on('intro.end', () => {
			__this.introCount -= 1;
		});

		__this.on('outro.start', ({ node }) => {
			__this.outros.push(node.textContent);
			__this.outroCount += 1;
		});

		__this.on('outro.end', () => {
			__this.outroCount -= 1;
		});
	});
</script>

{#each things as thing}
	{#if visible}
		<p transition:foo>{thing}</p>
	{/if}
{/each}